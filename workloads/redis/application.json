{
    "name": "redis",
    "serviceNames": ["redis-serve"],
    "loadTester": {
        "name": "redis-bench",
        "benchmarkController": {
            "initialize": {
                "path": "\/usr\/bin\/redis-cli",
                "args": [
                    "-h",
                    "redis-serve",
                    "-p",
                    "6379",
                    "flushall"
                ]
            },
            "command": {
                "path": "\/usr\/bin\/redis-benchmark",
                "args": [
                    "-h",
                    "redis-serve",
                    "-p",
                    "6379",
                    "--csv",
                    "-n",
                    "1000000",
                    "-t",
                    "GET"
                ],
                "intensityArgs": [
                    {
                        "name": "Number of connections",
                        "arg": "-c",
                        "startingValue": 5,
                        "step": 3
                    }
                ]
            }
        }
    },
    "type": "long-running",
    "slo": {
        "metric": "GET",
        "value": 35000,
        "type": "throughput"
    },
    "deploymentTemplate": "redis-base",
    "clusterDefinition": {
        "nodes": [
            {
                "instanceType": "t2.large",
                "id": 1
            },
            {
                "instanceType": "t2.large",
                "id": 2
            }
        ]
    },
    "taskDefinitions": [
        {
            "nodeMapping": {
                "task": "benchmark-agent",
                "id": 2
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "benchmark-agent"
                        },
                        "name": "benchmark-agent"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "benchmark-agent"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "benchmark-agent"
                                }
                            },
                            "spec": {
                                "hostname": "benchmark-agent",
                                "containers": [
                                    {
                                        "imagePullPolicy": "Always",
                                        "image": "hyperpilot/benchmark-agent",
                                        "name": "benchmark-agent",
                                        "ports": [
                                            {
                                                "containerPort": 7778,
                                                "hostPort": 7778,
                                                "protocol": "TCP"
                                            }
                                        ],
                                        "resources": {
                                            "limits": {
                                                "cpu": "1024.0m",
                                                "memory": "500Mi"
                                            }
                                        },
                                        "volumeMounts": [
                                            {
                                                "mountPath": "/var/run/docker.sock",
                                                "name": "docker-sock"
                                            }
                                        ]
                                    }
                                ],
                                "volumes": [
                                    {
                                        "hostPath": {
                                            "path": "/var/run/docker.sock"
                                        },
                                        "name": "docker-sock"
                                    }
                                ]
                            }
                        }
                    }
                },
                "portTypes": [
                    1
                ],
                "family": "benchmark-agent"
            }
        },
        {
            "nodeMapping": {
                "task": "redis-serve",
                "id": 2
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "redis-serve"
                        },
                        "name": "redis-serve"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "redis-serve"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "redis-serve"
                                }
                            },
                            "spec": {
                                "hostname": "redis-serve",
                                "containers": [
                                    {
                                        "imagePullPolicy": "Always",
                                        "image": "redis:3.2.6",
                                        "name": "redis-serve",
                                        "ports": [
                                            {
                                                "containerPort": 6379,
                                                "hostPort": 6379,
                                                "protocol": "TCP"
                                            }
                                        ],
                                        "resources": {
                                            "requests": {
                                                "cpu": "500.0m",
                                                "memory": "100Mi"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    }
                },
                "portTypes": [
                    1
                ],
                "family": "redis-serve"
            }
        },
        {
            "nodeMapping": {
                "task": "redis-bench",
                "id": 1
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "redis-bench"
                        },
                        "name": "redis-bench"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "redis-bench"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "redis-bench"
                                }
                            },
                            "spec": {
                                "imagePullSecrets": [
                                    {
                                        "name": "myregistrykey"
                                    }
                                ],
                                "containers": [
                                    {
                                        "image": "hyperpilot/benchmark-controller:redis",
                                        "name": "redis-bench",
                                        "imagePullPolicy": "Always",
                                        "ports": [
                                            {
                                                "containerPort": 6001,
                                                "hostPort": 6001,
                                                "protocol": "TCP"
                                            }
                                        ],
                                        "resources": {
                                            "requests": {
                                                "cpu": "512.0m",
                                                "memory": "350Mi"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    }
                },
                "portTypes": [
                    1
                ],
                "family": "redis-bench"
            }
        }
    ]
}