{
    "name": "spark",
    "serviceNames": [
        "spark-master"
    ],
    "loadTester": {
        "name": "benchmark-controller",
        "benchmarkController": {
            "command": {
                "image": "hyperpilot/spark-load-controller:latest",
                "path": ".\/run_jobs.sh",
                "args": [],
                "parserUrl": "https://s3.amazonaws.com/hyperpilot-benchmark-parsers/spark/parser.js",
                "intensityArgs": []
            }
        }
    },
    "type": "long-running",
    "slo": {
        "metric": "time",
        "value": 1000,
        "type": "latency"
    },
    "budget": {
        "value": 300,
        "unit": "dollar"
    },
    "deploymentTemplate": "analysis-base",
    "taskDefinitions": [
        {
            "nodeMapping": {
                "task": "spark-master",
                "id": 2
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions\/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "spark-master"
                        },
                        "name": "spark-master"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "spark-master"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "spark-master"
                                }
                            },
                            "spec": {
                                "volumes": [],
                                "containers": [
                                    {
                                        "image": "hyperpilot/spark:2.1.0-hadoop-2.7",
                                        "name": "spark-master",
                                        "env": [
                                            {
                                                "name": "SPARK_MASTER_PORT",
                                                "value": "7077"
                                            },
                                            {
                                                "name": "SPARK_MASTER_WEBUI_PORT",
                                                "value": "8088"
                                            }
                                        ],
                                        "volumeMounts": [],
                                        "ports": [
                                            {
                                                "containerPort": 4040,
                                                "hostPort": 4040,
                                                "protocol": "TCP"
                                            },
                                            {
                                                "containerPort": 6066,
                                                "hostPort": 6066,
                                                "protocol": "TCP"
                                            },
                                            {
                                                "containerPort": 7077,
                                                "hostPort": 7077,
                                                "protocol": "TCP"
                                            },
                                            {
                                                "containerPort": 8088,
                                                "hostPort": 8088,
                                                "protocol": "TCP"
                                            }
                                        ],
                                        "resources": {
                                            "limits": {
                                                "cpu": "500.0m"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    }
                },
                "family": "spark-master",
                "portTypes": [
                    0,
                    1,
                    0
                ]
            }
        },
        {
            "nodeMapping": {
                "task": "spark-worker",
                "id": 2
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions\/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "spark-worker"
                        },
                        "name": "spark-worker"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "spark-worker"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "spark-worker",
                                    "hyperpilot.io/wclass": "BE"
                                },
                                "annotations": {
                                    "scheduler.alpha.kubernetes.io/affinity": "{\n                                        \"nodeAffinity\": {\n                                            \"requiredDuringSchedulingIgnoredDuringExecution\": {\n                                                \"nodeSelectorTerms\": [\n                                                    {\n                                                        \"matchExpressions\": [\n                                                            {\n                                                                \"key\": \"hyperpilot.io\/be-enabled\",\n                                                                \"operator\": \"In\",\n                                                                \"values\": [\n                                                                    \"true\"\n                                                                ]\n                                                            }\n                                                        ]\n                                                    }\n                                                ]\n                                            }\n                                        }\n                                    }"
                                }
                            },
                            "spec": {
                                "volumes": [
                                    {
                                        "hostPath": {
                                            "path": "\/home\/ubuntu\/spark-local-dir"
                                        },
                                        "name": "spark-local-dir"
                                    }
                                ],
                                "containers": [
                                    {
                                        "volumeMounts": [
                                            {
                                                "mountPath": "\/tmp\/spark",
                                                "name": "spark-local-dir"
                                            }
                                        ],
                                        "image": "hyperpilot/spark:2.1.0-hadoop-2.7",
                                        "name": "spark-worker",
                                        "env": [
                                            {
                                                "name": "SPARK_WORKER_PORT",
                                                "value": "0"
                                            },
                                            {
                                                "name": "SPARK_LOCAL_DIRS",
                                                "value": "\/tmp\/spark"
                                            }
                                        ],
                                        "command": [
                                            "bin\/spark-class",
                                            "org.apache.spark.deploy.worker.Worker",
                                            "--cores",
                                            "9",
                                            "--memory",
                                            "15360M",
                                            "spark:\/\/spark-master:7077"
                                        ],
                                        "ports": [
                                            {
                                                "containerPort": 8081,
                                                "hostPort": 8081,
                                                "protocol": "TCP"
                                            }
                                        ],
                                        "resources": {}
                                    }
                                ]
                            }
                        }
                    }
                },
                "family": "spark-worker"
            }
        },
        {
            "nodeMapping": {
                "task": "benchmark-controller",
                "id": 1
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions\/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "benchmark-controller"
                        },
                        "name": "benchmark-controller"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "benchmark-controller"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "benchmark-controller"
                                }
                            },
                            "spec": {
                                "imagePullSecrets": [
                                    {
                                        "name": "myregistrykey"
                                    }
                                ],
                                "containers": [
                                    {
                                        "image": "hyperpilot\/benchmark-controller",
                                        "name": "benchmark-controller",
                                        "imagePullPolicy": "Always",
                                        "ports": [
                                            {
                                                "containerPort": 6001,
                                                "hostPort": 6001,
                                                "protocol": "TCP"
                                            }
                                        ],
                                        "resources": {
                                            "requests": {
                                                "cpu": "512.0m",
                                                "memory": "350Mi"
                                            }
                                        },
                                        "volumeMounts": [
                                            {
                                                "mountPath": "/var/run/docker.sock",
                                                "name": "docker-sock"
                                            },
                                            {
                                                "mountPath": "/usr/bin/docker",
                                                "name": "usr-bin-docker"
                                            }
                                        ]
                                    }
                                ],
                                "volumes": [
                                    {
                                        "hostPath": {
                                            "path": "/var/run/docker.sock"
                                        },
                                        "name": "docker-sock"
                                    },
                                    {
                                        "hostPath": {
                                            "path": "/usr/bin/docker"
                                        },
                                        "name": "usr-bin-docker"
                                    }
                                ]
                            }
                        }
                    }
                },
                "portTypes": [
                    1
                ],
                "family": "benchmark-controller"
            }
        },
        {
            "nodeMapping": {
                "task": "spark-load-controller",
                "id": 1
            },
            "taskDefinition": {
                "deployment": {
                    "apiVersion": "extensions\/v1beta1",
                    "kind": "Deployment",
                    "metadata": {
                        "labels": {
                            "app": "spark-load-controller",
                            "version": "latest"
                        },
                        "name": "spark-load-controller",
                        "namespace": "hyperpilot"
                    },
                    "spec": {
                        "replicas": 1,
                        "selector": {
                            "matchLabels": {
                                "app": "spark-load-controller",
                                "version": "latest"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "spark-load-controller",
                                    "version": "latest"
                                }
                            },
                            "spec": {
                                "containers": [
                                    {
                                        "image": "hyperpilot\/spark-load-controller:multiple_terasort",
                                        "name": "spark-load-controller",
                                        "imagePullPolicy": "Always",
                                        "command": [
                                            ".\/run_jobs.sh",
                                            "6"
                                        ],
                                        "resources": {}
                                    }
                                ]
                            }
                        }
                    }
                },
                "family": "spark-load-controller"
            }
        }
    ]
}
